---
title: "Data Visulization in R"
author: "Yiming Zhang"
date: "9/7/2019"
output: ioslides_presentation
widescreen: true
smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 7, 
                      fig.height = 3.5, 
                      fig.align = "center", warning = FALSE)

## Load packages
library(ggplot2)
library(ggrepel)

## Read data
nba.data <- read.csv("NBA_Team_Data.csv")
nba.data <- nba.data[, c(2, 3, 7, 9, 30, 31, 42, 44, 45)]



practice1 <- ggplot(data = nba.data, aes(x = OFFRTG, y = DEFRTG)) +
  geom_point(aes(color = REGION),
             shape = 1) + 
  geom_text(data = nba.data[which(nba.data$WIN. >= 0.6), ], aes(label = ABV), size = 2) +
  geom_text(data = nba.data[which(nba.data$WIN. <= 0.3), ], aes(label = ABV), size = 1.5) +
  facet_wrap(~SEASON) +
  theme_bw() +
  scale_y_reverse(limits = c(120, 97)) +
  scale_color_manual(values = c("blue3", "red3")) +
  theme()

ggplot() + 
  geom_dotplot(data = nba.data, aes(x = REGION, y = WIN.), 
               binaxis = "y", stackdir = "center") +
  geom_boxplot(data = nba.data, aes(x = REGION, y = WIN.)) +
  facet_wrap(~SEASON)
```


## Outline

- General introduction to data visualization

- Introduction to ggplot2 in R

- Practices with ggplot2

- Introduction to the extension of ggplot2

# General introduction to data visualization

## When to visualize data

- Exploratory data analysis

  + Explore pattern, trend, and distribution
  
  + Find correlation between variables
  
  + Regression analysis

- Report statistical results

- Communicate with non-statisticians

  + Share findings

  + Show fancy plots to your audiences

## What to plot

- One variable: Histogram, Bar chart, Density plot...

- Two variables: Scatter plot, Box plot, Violin Plot...

- Multiple variables: Heatmap...

## Why we need data visualization

- Better summary of statistics than table and text

- A more interesting way to show your results

## Introduction to the data set {.smaller}

- All data are from http://stats.nba.com

```{r}
head(nba.data)
```

- WIN.: Winning rate, which is the percentage of games played that a team has won.

- PTS: The number of points scored.

- OFFRTG: Offensive Rating, which measures a team's points scored per 100 possessions.

- DEFRTG: Defensive Rating, which is the number of points allowed per 100 possessions by a team.

- PACE: Pace, which is the number of possessions per 48 minutes for a team.

- REGION: East/West.

- ABV: The abbreviation of a team.

## What information can we get from this plot?

## What information can we get from this plot?

## But "bad" plots may....

- confuse people if labels and legends are not clear

- be hard to read because of close color

- deliver misleading information 

## What's the issue in this plot?

```{r}
ggplot(data = nba.data) + 
  geom_histogram(aes(x = WIN., color = REGION)) +
  scale_color_discrete("", )
```

## What's the issue in this plot?

```{r}
ggplot(data = nba.data, aes(x = OFFRTG, y = DEFRTG)) + 
  geom_point() +
  geom_smooth(method = "lm") + 
  facet_wrap(~SEASON, scales = "free")
```

## How to visualize data in R?

- `graphics`: The R basic graphics package

- `ggplot2`: The grammar of graphics

- `plotly`: Interactive plot in RShiny

- `leaflet`: Interactive maps

## Basic graphical package in R

## The `plot` function 

# Introduction to ggplot2

## ggplot2

- Grammar of graphic
- Both quick and complex plot in an easy way
- Nice aesthetic settings
- Great docummentation and active mailing list 

## An example of ggplot2 {.smaller}

The histogram of winning rate in different regular NBA seasons and region:

```{r, echo=TRUE}
ggplot(data = nba.data, aes(x = WIN.)) + 
  geom_histogram(binwidth = 0.1, color = "black") +
  facet_grid(REGION ~ SEASON) + theme_bw()
```

## Comparing with `graphics` package

```{r, fig.width = 8, fig.height = 5}
par(mfrow = c(2, 4), mar = c(2, 2, 3, 1))
for(i in levels(nba.data$REGION)){
  for(j in levels(nba.data$SEASON)){
    subdata <- subset(nba.data, REGION == i & SEASON == j)
    hist(subdata$WIN., breaks = seq(0.05, 0.95, 0.1),
         xlim = c(0, 1),
         main = paste(i, j, sep = " ,"))
  }
}
```

## Code for the same plot

```{r, echo = TRUE, eval = FALSE}
par(mfrow = c(2, 4), mar = c(2, 2, 3, 1))
for(i in levels(nba.data$REGION)){
  for(j in levels(nba.data$SEASON)){
    subdata <- subset(nba.data, REGION == i & SEASON == j)
    hist(subdata$WIN., breaks = seq(0, 1, 0.1),
         main = paste(i, j, sep = " ,"))
  }
}
```

## Grammar of Graphics


## The strat of plotting a graph {.smaller}

- `ggplot()` is always the first line of the ggplot.

- We can specify the **data** set and the **aesthetics** mapping variables in the `ggplot()`.

```{r, echo=TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.))
p
```

## Aesthetics

- Map the variables in the data to the components in the plot

- x: x axis

- y: y axis

- color: color of the boundary of a figure

- fill: color of the inside of a figure

- shape: shape of points, solid point, circle, triangle...

- size: size of points

- linetype: type of lines, solid line, dashed line...

- ...

## Geometries {.smaller}

- Geometries are the actual graphical elements displayed in a plot. They can visualize the mapping variables (specified in `aes()`) from the data.

- We use `+` to connect multiple geometrics

```{r, echo = TRUE}
p + geom_point()
```

## Geometries

- We can also specify `data` and `aes` in `geom` function. They don't have to be the same as those in `ggplot()`.

```{r}
p + geom_point(aes(x = DEFRTG, y = WIN.))
```


## `geom` function {.smaller}

- One variable

```{r, fig.show = "hold", out.width = "50%", fig.align='default', echo=TRUE}
p <- ggplot(data = nba.data, aes(x = WIN.))
p + geom_histogram(binwidth = 0.1)
p + geom_density()
```


## `geom` function {.smaller}

- Continuous X, continuous Y

```{r, fig.show = "hold", out.width = "35%", fig.align='default', echo=TRUE, fig.height=3.5, fig.width=7}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.))
p + geom_point(); p + geom_line(); p + geom_density_2d(); p + geom_smooth(method = "lm")
```

## `geom` function {.smaller}

- Discrete X, continuous Y

```{r, fig.show = "hold", out.width = "50%", fig.align='default', echo=TRUE}
p <- ggplot(data = nba.data, aes(x = SEASON, y = WIN.))
p + geom_boxplot()
p + geom_violin()
```

## Multiple `geom` layers

```{r, echo=TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = WIN.)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.1, color = "black") +
  geom_density()
```

## Multiple `geom` layers

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

## Multiple `geom` layers

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = SEASON, y = WIN.)) +
  geom_violin() +
  geom_boxplot(width = 0.2)
```

## The order of `geom` functions is important

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = SEASON, y = WIN.)) +
  geom_boxplot(width = 0.2) +
  geom_violin()
```

## Facet {.smaller}

- Facet function can help you make panel plot very easily

- `facet_wrap` wraps a 1d sequence of panels into 2d.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_wrap(~SEASON)
```

## Facet {.smaller}

- `facet_grid` forms a matrix of panels defined by row and column faceting variables.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON)
```

## Facet {.smaller}

- You can free the scales of x axis and y axis.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON, scales = "free")
```

## Facet 

- Be careful when you free your scales...

```{r, fig.width=6, fig.height=4, out.width="50%", fig.align='default'}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON)
p + facet_grid(REGION ~ SEASON, scales = "free")
```

## Scale

The scale functions control how the plot maps data values to the visual values of an aesthetic, for instance,

`scale_x_continuous`

`scale_y_discrete`

`scale_color_gradient`

`scale_fill_manual`

## Scale: General Purpose Scales

- `scale_*_continuous`: change the scale for continuous data

- `scale_*_discrete`: change the scale for discrete data

- `scale_*_identity`: use values without scaling

- `scale_*_manual`: create your own discrete scale

## Scale: General Purpose Scales

```{r, fig.show = "hold", out.width = "35%", fig.align='default', echo=TRUE, fig.height=3.5, fig.width=7}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN., color = REGION)) + 
  geom_point()
p + geom_point(); p + geom_line(); p + geom_density_2d(); p + geom_smooth(method = "lm")
```

## Scale: X and Y Axis

## Scale: Color & Fill

## Scale: Shape and Linetype

## Scale: linetype

## Theme {.smaller}

- We can change the theme of plot using `theme_*` function

```{r, fig.show = "hold", out.width = "35%", fig.align='default', echo=TRUE, fig.height=3.5, fig.width=7}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) + 
  geom_point() + geom_smooth(method = "lm")
p + theme_bw(); p + theme_classic(); p + theme_grey(); p + theme_minimal()
```

## ggplot2 cheat sheet

- We don't need to memorize all the stuffs. The cheatsheet of ggplot2 gives us a tidy and detailed reference.

https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf

- R help is also a great resource

## Practice 1

```{r, fig.width=9, fig.height=5.5}
practice1
```

## Practice 2

# Extentions of ggplot2

## Extentions of ggplot2

- GGally: An extention to reduce the complexity of combining geometric objects with transformed data

- ggmap: Plot map based on the grammar of graphics

- ggrepel: A convenient package for `geom_text()`

- ggvis: Interactive plots based on grammar of graphics

- gganimate: A grammar of animated graphics

- more information: http://www.ggplot2-exts.org/gallery/

## GGally

## ggmap

## ggrepel

## ggvis

## Reference

# Thanks for listening!
