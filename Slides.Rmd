---
title: "Data Visulization in R"
author: "Yiming Zhang"
date: "9/7/2019"
output: ioslides_presentation
widescreen: true
smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 7, 
                      fig.height = 3.5, 
                      fig.align = "center", warning = FALSE)

## Load packages
library(ggplot2)
library(ggrepel)

## Read data
nba.data <- read.csv("NBA_Team_Data.csv")

```

## Outline

## Introduction to the data set

## 4W’s and the H of data visualization - Who

## 4W’s and the H of data visualization - When

## 4W’s and the H of data visualization - What

## 4W’s and the H of data visualization - Why

## What information can we get from this plot?

## But "bad" plots may....

## What's the issue in this plot?

## What's the issue in this plot?

## What's the issue in this plot?

## 4W’s and the H of data visualization - How

## Basic graphical package in R

## The `plot` function 

## ggplot2

- Grammar of graphic
- Both quick and complex plot in an easy way
- Nice aesthetic settings
- Great docummentation and active mailing list 

## An example of ggplot2 {.smaller}

The histogram of winning rate in different regular NBA seasons and region:

```{r, echo=TRUE}
ggplot(data = nba.data, aes(x = WIN.)) + 
  geom_histogram(binwidth = 0.1, color = "black") +
  facet_grid(REGION ~ SEASON) + theme_bw()
```

## Comparing with `graphics` package

```{r, fig.width = 8, fig.height = 5}
par(mfrow = c(2, 4), mar = c(2, 2, 3, 1))
for(i in levels(nba.data$REGION)){
  for(j in levels(nba.data$SEASON)){
    subdata <- subset(nba.data, REGION == i & SEASON == j)
    hist(subdata$WIN., breaks = seq(0.05, 0.95, 0.1),
         xlim = c(0, 1),
         main = paste(i, j, sep = " ,"))
  }
}
```

## Code for the same plot

```{r, echo = TRUE, eval = FALSE}
par(mfrow = c(2, 4), mar = c(2, 2, 3, 1))
for(i in levels(nba.data$REGION)){
  for(j in levels(nba.data$SEASON)){
    subdata <- subset(nba.data, REGION == i & SEASON == j)
    hist(subdata$WIN., breaks = seq(0, 1, 0.1),
         main = paste(i, j, sep = " ,"))
  }
}
```

## Grammar of Graphics


## The strat of plotting a graph {.smaller}

- `ggplot()` is always the first line of the ggplot.

- We can specify the **data** set and the **aesthetics** mapping variables in the `ggplot()`.

```{r, echo=TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.))
p
```

## Aesthetics

- Map the variables in the data to the components in the plot

- x: x axis

- y: y axis

- color: color of the boundary of a figure

- fill: color of the inside of a figure

- shape: shape of points, solid point, circle, triangle...

- size: size of points

- linetype: type of lines, solid line, dashed line...

- ...

## Geometries {.smaller}

- Geometries are the actual graphical elements displayed in a plot. They can visualize the mapping variables (specified in `aes()`) from the data.

- We use `+` to connect multiple geometrics

```{r, echo = TRUE}
p + geom_point()
```

## Geometries

- We can also specify `data` and `aes` in `geom` function. They don't have to be the same as those in `ggplot()`.

```{r}
p + geom_point(aes(x = DEFRTG, y = WIN.))
```


## `geom` function {.smaller}

- One variable

```{r, fig.show = "hold", out.width = "50%", fig.align='default', echo=TRUE}
p <- ggplot(data = nba.data, aes(x = WIN.))
p + geom_histogram(binwidth = 0.1)
p + geom_density()
```


## `geom` function {.smaller}

- Continuous X, continuous Y

```{r, fig.show = "hold", out.width = "35%", fig.align='default', echo=TRUE, fig.height=3.5, fig.width=7}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.))
p + geom_point(); p + geom_line(); p + geom_density_2d(); p + geom_smooth(method = "lm")
```

## `geom` function {.smaller}

- Discrete X, continuous Y

```{r, fig.show = "hold", out.width = "50%", fig.align='default', echo=TRUE}
p <- ggplot(data = nba.data, aes(x = SEASON, y = WIN.))
p + geom_boxplot()
p + geom_violin()
```

## Multiple `geom` layers

```{r, echo=TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = WIN.)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.1, color = "black") +
  geom_density()
```

## Multiple `geom` layers

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

## Multiple `geom` layers

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = SEASON, y = WIN.)) +
  geom_violin() +
  geom_boxplot(width = 0.2)
```

## The order of `geom` functions is important

```{r, echo = TRUE, fig.width=8, fig.height=4}
ggplot(data = nba.data, aes(x = SEASON, y = WIN.)) +
  geom_boxplot(width = 0.2) +
  geom_violin()
```

## Facet {.smaller}

- Facet function can help you make panel plot very easily

- `facet_wrap` wraps a 1d sequence of panels into 2d.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_wrap(~SEASON)
```

## Facet {.smaller}

- `facet_grid` forms a matrix of panels defined by row and column faceting variables.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON)
```

## Facet {.smaller}

- You can free the scales of x axis and y axis.

```{r, echo = TRUE}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON, scales = "free")
```

## Facet 

- Be careful when you free your scales...

```{r, fig.width=6, fig.height=4, out.width="50%", fig.align='default'}
p <- ggplot(data = nba.data, aes(x = OFFRTG, y = WIN.)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE)
p + facet_grid(REGION ~ SEASON)
p + facet_grid(REGION ~ SEASON, scales = "free")
```

## Scale

## Scale: axis

## Scale: shape

## Scale: linetype

## Scale: color & fill

## theme

## coord

## ggplot2 cheat sheet

https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf

## Practice

```{r, fig.width=9, fig.height=5.5}
ggplot(data = nba.data, aes(x = OFFRTG, y = DEFRTG)) +
  geom_point(aes(size = WIN., color = REGION),
             shape = 1) + 
  geom_text(data = nba.data[which(nba.data$WIN. >= 0.6), ], aes(label = ABV), size = 2) +
  geom_text(data = nba.data[which(nba.data$WIN. <= 0.3), ], aes(label = ABV), size = 1.5) +
  facet_wrap(~SEASON) +
  theme_bw() +
  scale_y_reverse(limits = c(120, 97)) +
  scale_color_manual(values = c("skyblue3", "red3")) +
  scale_size(range = c(1,8)) +
  theme()
```




